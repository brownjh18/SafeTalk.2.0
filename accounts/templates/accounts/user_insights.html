{% extends 'base.html' %}

{% block title %}User Insights - SafeTalk{% endblock %}

{% block content %}
<div class="page-header">
    <h1 class="page-title">User Insights & Analytics</h1>
    <p class="page-subtitle">Comprehensive analytics and insights for mental health tracking</p>
</div>

<div class="insights-container">
    <!-- Mood Statistics -->
    <div class="insights-section">
        <h2 class="section-title">Mood Statistics</h2>
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-number">{{ mood_stats.total_entries|default:0 }}</div>
                <div class="stat-label">Total Entries</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">{{ mood_stats.avg_mood|floatformat:1|default:"0.0" }}</div>
                <div class="stat-label">Average Mood</div>
            </div>
        </div>
    </div>

    <!-- Monthly Trends -->
    {% if monthly_trends %}
    <div class="insights-section">
        <h2 class="section-title">Monthly Mood Trends</h2>
        <div class="trends-chart">
            <canvas id="monthlyTrendsChart" width="400" height="200"></canvas>
        </div>
    </div>
    {% endif %}

    <!-- User Activity -->
    {% if user_activity %}
    <div class="insights-section">
        <h2 class="section-title">User Activity</h2>
        <div class="activity-list">
            {% for user in user_activity %}
            <div class="activity-item">
                <div class="activity-user">{{ user.username }}</div>
                <div class="activity-count">{{ user.mood_count }} entries</div>
            </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}

{% block extra_scripts %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Monthly Trends Chart
    {% if monthly_trends %}
    const monthlyData = {{ monthly_trends|safe }};
    const ctx = document.getElementById('monthlyTrendsChart').getContext('2d');

    new Chart(ctx, {
        type: 'line',
        data: {
            labels: monthlyData.map(item => new Date(item.month).toLocaleDateString()),
            datasets: [{
                label: 'Average Mood',
                data: monthlyData.map(item => item.avg_mood),
                borderColor: '#4f46e5',
                backgroundColor: 'rgba(79, 70, 229, 0.1)',
                tension: 0.4,
                fill: true
            }]
        },
        options: {
            responsive: true,
            plugins: {
                legend: {
                    display: false
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    max: 5
                }
            }
        }
    });
    {% endif %}
});
</script>

<style>
.insights-container {
    max-width: 1200px;
    margin: 0 auto;
}

.insights-section {
    background: white;
    border-radius: 12px;
    padding: 2rem;
    margin-bottom: 2rem;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
}

.section-title {
    font-size: 1.5rem;
    font-weight: 600;
    color: #1f2937;
    margin-bottom: 1.5rem;
    border-bottom: 2px solid #e5e7eb;
    padding-bottom: 0.5rem;
}

.stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1rem;
}

.stat-card {
    background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
    border-radius: 8px;
    padding: 1.5rem;
    text-align: center;
    border: 1px solid #e2e8f0;
}

.stat-number {
    font-size: 2rem;
    font-weight: 700;
    color: #4f46e5;
    margin-bottom: 0.5rem;
}

.stat-label {
    font-size: 0.875rem;
    color: #64748b;
    font-weight: 500;
}

.trends-chart {
    height: 300px;
    position: relative;
}

.activity-list {
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
}

.activity-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 1rem;
    background: #f8fafc;
    border-radius: 8px;
    border: 1px solid #e2e8f0;
}

.activity-user {
    font-weight: 600;
    color: #1f2937;
}

.activity-count {
    color: #64748b;
    font-size: 0.875rem;
}

@media (max-width: 768px) {
    .insights-section {
        padding: 1rem;
    }

    .stats-grid {
        grid-template-columns: 1fr;
    }

    .stat-card {
        padding: 1rem;
    }

    .stat-number {
        font-size: 1.5rem;
    }
}
</style>
{% endblock %}